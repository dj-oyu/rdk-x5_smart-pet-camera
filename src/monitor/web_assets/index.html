<!DOCTYPE html>
<html>
<head>
    <title>Smart Pet Camera Monitor</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/assets/monitor.css">
</head>
<body>
    <div class="app">
        <div class="header">
            <div class="title">Smart Pet Camera Monitor</div>
            <span class="badge badge-secondary" id="status-badge">Waiting for data...</span>
        </div>

        <div class="main-content">
            <!-- Video Area -->
            <div class="video-container">
                <div id="video-panel">
                    <!-- WebRTC View (default) -->
                    <div id="webrtc-view" style="position:relative;width:100%;display:block;">
                        <video id="webrtc-video" autoplay playsinline muted
                               style="width:100%;height:auto;display:block;background:#000;border-radius:8px;"></video>
                        <canvas id="bbox-canvas"
                                style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;"></canvas>
                    </div>
                    <!-- MJPEG View (fallback) -->
                    <div id="mjpeg-view" style="display:none;">
                        <img id="stream" alt="Camera stream" style="width:100%;height:auto;border-radius:8px;">
                    </div>
                </div>
                <!-- Video Controls -->
                <div class="video-controls">
                    <div class="view-toggle">
                        <button type="button" id="btn-webrtc" class="active">WebRTC</button>
                        <button type="button" id="btn-mjpeg">MJPEG</button>
                    </div>
                    <div class="record-controls">
                        <button id="record-btn" class="record-btn" title="REC">
                            <span class="record-icon"></span>
                            <span class="dummy-tooltip">DUMMY</span>
                        </button>
                        <!-- TODO: 録画実装完了後に復活 <span id="record-status" class="record-status"></span> -->
                    </div>
                </div>
            </div>

            <!-- Hidden elements for JS compatibility -->
            <div style="display:none;">
                <span id="stream-subtitle"></span>
                <span id="stream-footer"></span>
                <span id="fps"></span>
                <span id="target-fps"></span>
                <span id="detections"></span>
                <span id="detection-version"></span>
                <span id="shm-buffer"></span>
                <span id="last-updated"></span>
                <span id="frames-total"></span>
                <span id="event-rate"></span>
                <span id="bandwidth"></span>
                <span id="bandwidth-reduction"></span>
                <span id="record-info"></span>
            </div>

            <!-- Trajectory visualization -->
            <div class="trajectory-card" id="trajectory-card">
                <canvas class="trajectory-canvas" id="trajectory-canvas"></canvas>
                <div class="legend" id="trajectory-legend"></div>
            </div>

            <!-- Detection Insights -->
            <div class="panel">
                <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
                    <div>
                        <h2>検出インサイト</h2>
                        <p class="panel-subtitle">履歴・ランキング・タイムラインを切り替えて把握</p>
                    </div>
                    <div class="view-toggle" id="view-toggle">
                        <button type="button" data-view="history" class="active">履歴</button>
                        <button type="button" data-view="ranking">ランキング</button>
                        <button type="button" data-view="timeline">タイムライン</button>
                    </div>
                </div>
                <div class="detections" id="history-list">
                    <p class="muted">まだ検出結果はありません。カメラ入力を待機しています。</p>
                </div>
                <div class="rank-list" id="ranking-list" style="display:none;"></div>
                <div class="timeline" id="timeline-list" style="display:none;"></div>
                <div class="timeline-chart" id="timeline-chart" style="display:none;">
                    <canvas class="timeline-canvas" id="timeline-canvas"></canvas>
                    <div class="legend" id="timeline-legend"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="/assets/monitor.js"></script>
    <script type="module" src="/assets/app.js"></script>
</body>
</html>
